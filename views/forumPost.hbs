<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Post</title>
    <link rel="stylesheet" href="/forumPost.css">
</head>
<body>

    <main>
        <article class="post" id = 'postContainer'>
            <h2 class="post-title" id = 'Title'></h2>
            <div class="post-content">
                <img src="" alt="" id = 'Image' class="post-image">
                <p class="post-text" id = 'Text'></p>
            </div>
            <hr>
            <div class="comments">
                <h3>Comments</h3>

            </div>
            <form action="#" method="POST" class="comment-form">
                <textarea name="comment" id="comment" rows="3" placeholder="Write a comment..."></textarea>
                <button type="submit">Post Comment</button>
            </form>

            <div id="deleteButtonContainer"></div>

        </article>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        async function fetchPostBasedonID() {
            try {
                const postID = location.search.split('=')[1]
                const response = await axios.get(`/auth/api/PostFetchBasedOnID?id=${postID}`);
                const post = response.data[0];
                
                
                const titleElement = document.getElementById('Title');
                const imageElement = document.getElementById('Image');
                const textElement = document.getElementById('Text');

                titleElement.textContent = post.Title;
                imageElement.src = post.Picture;
                textElement.textContent = post.Text;

                

                const deleteButton = await deletepost(post.Username , postID);
                if (deleteButton) {
                    document.getElementById('deleteButtonContainer').appendChild(deleteButton);
                }
                  
            } catch (error) {
                console.error('Error fetching posts:', error);
            }
         }
         fetchPostBasedonID();

         async function deletepost(Username,postID)  {
            try {
                const response = await axios.get('/auth/api/deletepost');
                const userinfo = response.data[0];
                
                const checkusername = userinfo.Username
            
                 if (Username === checkusername) {
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete Post';
                    // Use onclick to attach a function to the button click event
                    deleteButton.onclick = async function() {
                        try {
                            // Send request to delete post from the database
                            await deletepostfromdatabase(postID);
                            console.log('Post deleted successfully');
                            // Optionally, you can update the UI or perform additional actions after successful deletion
                        } catch (error) {
                            console.error('Error deleting post:', error);
                        }
                    };
                    return deleteButton;
                } else {
                    return null;
                }

                }  catch (error) {
                console.error('Error deleting posts:', error);
            }
         }

        async function deletepostfromdatabase(postID) {
    try {
        // Send post ID to backend for deletion
        const response = await axios.post('/auth/api/deletepostforum', { postId: postID });
        console.log('Post deleted successfully');
        // Optionally, you can handle the response or update the UI after successful deletion
    } catch(error) {
        console.error('Error deleting post:', error);
    }
}


         
      </script>

</body>
</html>